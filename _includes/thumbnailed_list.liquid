{% comment %}
  Thumbnailed list component
  Parameters:
  - title: Section heading
  - items: Collection to render
  - more_url: Optional link target for "See more"
  - more_label: Optional label for the link (default: See more)
  - featured_only: If true, only include items with carousel: true (default: true)
{% endcomment %}



{%- assign source_items = include.items | default: site.softwares -%}
{%- assign _featured_param = include.featured_only | default: 'false' | downcase -%}
{%- assign _prefer_long_param = include.prefer_long_description | default: 'false' | downcase -%}
{%- assign _show_links_param = include.include_links | default: 'false' | downcase -%}
{%- assign _compact_param = include.compact | default: 'true' | downcase -%}

{%- assign _is_featured = true -%}
{%- if _featured_param == 'false' or _featured_param == false or _featured_param == '0' or _featured_param == 'no' -%}
  {%- assign _is_featured = false -%}
{%- endif -%}

{%- assign _prefer_long = true -%}
{%- if _prefer_long_param == 'false' or _prefer_long_param == false or _prefer_long_param == '0' or _prefer_long_param == 'no' -%}
  {%- assign _prefer_long = false -%}
{%- endif -%}

{%- assign _show_links = true -%}
{%- if _show_links_param == 'false' or _show_links_param == false or _show_links_param == '0' or _show_links_param == 'no' -%}
  {%- assign _show_links = false -%}
{%- endif -%}

{%- assign _is_compact = false -%}
{%- if _compact_param == 'true' or _compact_param == true or _compact_param == '1' or _compact_param == 'yes' -%}
  {%- assign _is_compact = true -%}
{%- endif -%}

{%- assign _show_title_param = include.show_title | default: 'false' | downcase -%}
{%- assign _show_title = false -%}
{%- if _show_title_param == 'true' or _show_title_param == true or _show_title_param == '1' or _show_title_param == 'yes' -%}
  {%- assign _show_title = true -%}
{%- endif -%}

{%- assign _large_icon_param = include.large_icon | default: 'false' | downcase -%}
{%- assign _large_icon = false -%}
{%- if _large_icon_param == 'true' or _large_icon_param == true or _large_icon_param == '1' or _large_icon_param == 'yes' -%}
  {%- assign _large_icon = true -%}
{%- endif -%}

{% if _is_featured %}
  {% assign list_items = source_items | where: 'carousel', true %}
{% else %}
  {% assign list_items = source_items %}
{% endif %}

{% assign list_items = list_items | sort: 'order' %}

{% if list_items.size > 0 %}
  <div class="lab-thumb-list mb-5">
    {% if include.title %}
      <h2 class="mb-3" style="text-align: left;">
        {% if include.title_url %}
          <a href="{{ include.title_url | relative_url }}" style="color: inherit; text-decoration: none;">{{ include.title }}</a>
        {% else %}
          {{ include.title }}
        {% endif %}
      </h2>
    {% endif %}

    <div class="row">
      {% for item in list_items %}
        <div class="col-12 mb-3">
          <div class="thumb-list-card p-3 h-100">
            <a href="{{ item.url | relative_url }}" class="text-decoration-none d-block">

              {% if _show_title and item.title %}
              <h5 class="thumb-list-title mb-2">{{ item.title }}</h5>
              {% endif %}

            {% if item.subtitle %}
            <div class="thumb-list-subtitle mb-2" style="font-size: 0.85rem; font-weight: 300; color: #888; line-height: 1.2; font-style: italic;">
             {{ item.subtitle }}
            </div>
            {% endif %}
              {%- assign desc_text = nil -%}
              {%- if _prefer_long and item.long_description -%}
                {%- assign desc_text = item.long_description -%}
              {%- elsif item.description -%}
                {%- assign desc_text = item.description -%}
              {%- endif -%}

              {% if _large_icon %}
                <div class="thumb-list-content large-icon-mode d-flex flex-column flex-md-row" style="gap:0.75rem;{% unless _is_compact %} padding-top: 0.75rem;{% endunless %}">
                  {% assign item_image = item.image | default: item.img %}
                  {% if item_image %}
                    <div class="thumb-list-thumb" style="flex: 0 0 240px; max-width: 240px; min-width: 240px;">
                      <img src="{{ item_image | relative_url }}" alt="{{ item.title }}" class="img-fluid rounded" style="width:100%; height:auto; object-fit:contain;">
                    </div>
                  {% endif %}

                  {% if desc_text %}
                    <div style="flex: 1 1 0; min-width: 0; line-height: 1.5;">
                      <p class="thumb-list-desc mb-0">{{ desc_text }}</p>
                    </div>
                  {% endif %}
                </div>
              {% else %}
                <div class="thumb-list-content"{% unless _is_compact %} style="padding-top: 0.75rem;"{% endunless %}>
                  {% assign item_image = item.image | default: item.img %}
                  {% if item_image %}
                    <div class="thumb-list-thumb">
                      <img src="{{ item_image | relative_url }}" alt="{{ item.title }}" class="img-fluid rounded">
                    </div>
                  {% endif %}
                  {% if desc_text %}
                    <p class="thumb-list-desc mb-0">{{ desc_text }}</p>
                  {% endif %}
                </div>
              {% endif %}
            </a>

            {% if _show_links and item.links %}
              <div class="mt-2">
                {%- if item.links.first and item.links.first.name and item.links.first.url -%}
                  {%- comment -%} links: [ { name: ..., url: ... }, ... ] {%- endcomment -%}
                  {% for link in item.links %}
                    {% if link.name and link.url %}
                      <a class="btn btn-sm btn-primary me-2 mb-2" href="{{ link.url }}" target="_blank" rel="noopener noreferrer">{{ link.name }}</a>
                    {% endif %}
                  {% endfor %}
                {%- else -%}
                  {%- comment -%} links: { Label: URL, ... } {%- endcomment -%}
                  {% for pair in item.links %}
                    <a class="btn btn-sm btn-primary me-2 mb-2" href="{{ pair[1] }}" target="_blank" rel="noopener noreferrer">{{ pair[0] }}</a>
                  {% endfor %}
                {%- endif -%}
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    {% if include.more_url %}
      <div class="mt-3">
        <a class="btn btn-sm btn-primary" href="{{ include.more_url | relative_url }}">
          {{- include.more_label | default: 'See all' -}}
        </a>
      </div>
    {% endif %}
  </div>
{% endif %}
